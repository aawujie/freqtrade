# Freqtrade 配置文件详解 - 小白完全指南

## 📋 目录
- [基础概念](#基础概念)
- [配置文件结构](#配置文件结构)
- [核心配置详解](#核心配置详解)
- [交易所配置](#交易所配置)
- [订单和超时设置](#订单和超时设置)
- [通知配置](#通知配置)
- [API服务器设置](#api服务器设置)
- [实战示例](#实战示例)
- [常见错误和解决方案](#常见错误和解决方案)
- [配置文件检查清单](#配置文件检查清单)

## 🎯 基础概念

### 什么是配置文件？
配置文件是告诉freqtrade"怎么交易"的说明书，包含：
- 💰 **资金管理**: 用多少钱、每笔投多少
- 🏪 **交易所设置**: 在哪个交易所交易、用什么API
- 📊 **交易对选择**: 交易哪些币种
- ⚡ **策略参数**: 买卖信号的规则
- 🛡️ **风险控制**: 止损、最大开仓数等

### 配置文件 vs 策略文件 - 分工合作

#### 🤝 **它们是如何配合工作的？**

**简单理解**:
- **策略文件** = 大脑 (决定什么时候买卖)
- **配置文件** = 执行器 (决定怎么买卖)

#### 📊 **完整工作流程**

```
1. 策略分析市场数据
   ↓
2. 策略说: "现在应该买入BTC"
   ↓  
3. 配置文件接收信号，决定:
   - 用多少钱买? (stake_amount)
   - 用什么价格买? (entry_pricing)
   - 在哪个交易所买? (exchange)
   - 超时多久取消? (unfilledtimeout)
   ↓
4. 向交易所发送订单
   ↓
5. 订单成交，开始监控
   ↓
6. 策略说: "现在应该卖出"
   ↓
7. 配置文件决定卖出价格和方式
   ↓
8. 完成交易，记录结果
```

#### 🎯 **具体分工**

**策略文件负责 (sample_strategy.py)**:
```python
# 策略决定买卖时机
def populate_entry_trend(self, dataframe, metadata):
    dataframe.loc[
        (dataframe['rsi'] < 30) &  # RSI小于30
        (dataframe['volume'] > 0), # 有交易量
        'enter_long'  # 发出买入信号
    ] = 1
    return dataframe
```

**配置文件负责 (config.json)**:
```json
{
  "stake_amount": 100,        // 策略说买，我用100 USDT买
  "max_open_trades": 3,       // 最多同时持有3个仓位
  "entry_pricing": {          // 买入时用什么价格
    "price_side": "same"      // 用买1档价格
  }
}
```

#### 💡 **举个完整例子**

**场景**: BTC价格从30000跌到29000

**策略的判断**:
```python
# RSI从70降到25，策略认为超卖了
if dataframe['rsi'] < 30:
    return "买入信号"  # 策略只负责判断时机
```

**配置的执行**:
```json
{
  "stake_amount": 200,           // 用200 USDT买
  "entry_pricing": {
    "price_side": "other",       // 用卖1档价格(29001)立即成交
    "use_order_book": true
  },
  "unfilledtimeout": {
    "entry": 5                   // 5分钟内不成交就取消
  }
}
```

**实际执行**:
1. 策略: "BTC超卖了，现在买入！"
2. 配置: "好的，我用200 USDT，以29001的价格买入"
3. 交易所: "订单已提交"
4. 5分钟后成交，持有0.0069个BTC

这样你就明白了：**策略是大脑，配置是手脚！**

### 配置文件类型
```
config.json          # 实盘/模拟交易配置
config_backtest.json  # 回测专用配置
config_hyperopt.json  # 参数优化配置
```

## 📁 配置文件结构

```json
{
  "基础设置": {
    "max_open_trades": "最大同时开仓数",
    "stake_currency": "基础货币",
    "stake_amount": "每笔投资金额"
  },
  "交易所配置": {
    "exchange": "交易所设置"
  },
  "策略配置": {
    "pairlists": "交易对选择规则"
  },
  "风险管理": {
    "unfilledtimeout": "订单超时设置"
  },
  "通知设置": {
    "telegram": "Telegram通知"
  }
}
```

## ⚙️ 核心配置详解

### 1. 基础交易设置

#### `max_open_trades` - 最大开仓数
```json
"max_open_trades": 3
```
- **含义**: 同时最多开几个仓位
- **建议值**:
  - 新手: `3-5` (便于管理)
  - 进阶: `10-20` (分散风险)
  - 无限制: `-1` (谨慎使用)

#### `stake_currency` - 基础货币
```json
"stake_currency": "USDT"
```
- **含义**: 用什么币种作为本金
- **常用选择**:
  - `"USDT"` - 美元稳定币 (推荐)
  - `"BUSD"` - 币安稳定币
  - `"BTC"` - 比特币本位

#### `stake_amount` - 每笔投资金额
```json
"stake_amount": 100
```
- **含义**: 每次开仓投入多少钱
- **设置建议**:
  - 固定金额: `100` (每次投100 USDT)
  - 按比例: `"10%"` (每次投总资金的10%)
  - 无限制: `"unlimited"` (用完所有资金)

#### `tradable_balance_ratio` - 可交易资金比例
```json
"tradable_balance_ratio": 0.99
```
- **含义**: 账户中多少比例的资金可以用来交易
- **建议**: `0.95-0.99` (留一点手续费余量)

### 2. 交易模式设置

#### `dry_run` - 模拟交易开关
```json
"dry_run": true
```
- **true**: 模拟交易 (不花真钱，适合测试)
- **false**: 实盘交易 (花真钱，小心使用)

#### `dry_run_wallet` - 模拟资金
```json
"dry_run_wallet": 1000
```
- **含义**: 模拟交易时的虚拟资金
- **建议**: 设置为你实际想投入的金额

#### `trading_mode` - 交易模式
```json
"trading_mode": "futures"
```
- **选项**:
  - `"spot"` - 现货交易 (买币持有)
  - `"futures"` - 合约交易 (可做空，有杠杆)

#### `margin_mode` - 保证金模式 (仅合约)
```json
"margin_mode": "isolated"
```
- **isolated**: 逐仓模式 (推荐，风险隔离)
- **cross**: 全仓模式 (风险较高)

## 🏪 交易所配置

### 基本设置
```json
"exchange": {
  "name": "binance",
  "key": "你的API_KEY",
  "secret": "你的API_SECRET",
  "pair_whitelist": ["BTC/USDT:USDT", "ETH/USDT:USDT"],
  "pair_blacklist": ["BNB/.*"]
}
```

#### `name` - 交易所名称
- **支持的交易所**: binance, okx, bybit, gate, huobi等
- **推荐**: binance (流动性好，手续费低)

#### `key` 和 `secret` - API密钥
- **获取方式**: 在交易所官网申请API密钥
- **权限设置**: 只需要"交易"权限，不要给"提现"权限
- **安全提醒**: 绝对不要泄露给别人！

#### `pair_whitelist` - 交易对白名单
```json
"pair_whitelist": [
  "BTC/USDT:USDT",  // 比特币合约
  "ETH/USDT:USDT",  // 以太坊合约
  "BNB/USDT:USDT"   // BNB合约
]
```

#### `pair_blacklist` - 交易对黑名单
```json
"pair_blacklist": [
  "BNB/.*",     // 排除所有BNB相关交易对
  ".*/BTC",     // 排除所有以BTC为基础货币的
  "DOGE/.*"     // 排除狗狗币
]
```

### 交易对选择策略 (pairlists)

#### 静态列表 (适合新手)
```json
"pairlists": [
  {
    "method": "StaticPairList"
  }
]
```
- **特点**: 只交易whitelist中指定的币种
- **优点**: 可控、稳定
- **适用**: 新手、回测

#### 动态选择 (适合进阶)
```json
"pairlists": [
  {
    "method": "VolumePairList",
    "number_assets": 20,
    "sort_key": "quoteVolume",
    "min_value": 0,
    "refresh_period": 1800
  }
]
```
- **特点**: 自动选择交易量大的币种
- **参数说明**:
  - `number_assets`: 选择前20个币种
  - `sort_key`: 按交易量排序
  - `refresh_period`: 每30分钟更新一次

## ⏰ 订单和超时设置

### `unfilledtimeout` - 订单超时
```json
"unfilledtimeout": {
  "entry": 10,
  "exit": 10,
  "exit_timeout_count": 0,
  "unit": "minutes"
}
```
- **entry**: 买入订单10分钟未成交就取消
- **exit**: 卖出订单10分钟未成交就取消
- **unit**: 时间单位 (minutes/seconds)

### 价格设置详解

#### 配置与策略的配合工作原理

**工作流程**:
```
1. 策略产生买入信号 → 2. 配置决定用什么价格下单 → 3. 交易所执行订单
```

#### 价格配置详解
```json
"entry_pricing": {
  "price_side": "same",
  "use_order_book": true,
  "order_book_top": 1
},
"exit_pricing": {
  "price_side": "same", 
  "use_order_book": true,
  "order_book_top": 1
}
```

#### `price_side` - 价格方向选择

**理解订单簿**:
```
卖单 (Ask)  ← 有人想卖的价格 ↑ 价格越高
├── 100.3 USDT (卖3档) ← order_book_top: 3 (价格最高)
├── 100.4 USDT (卖2档) ← order_book_top: 2
├── 100.5 USDT (卖1档) ← order_book_top: 1 (价格最低，对买方最优)
─────────────────────── 价差 (Spread = 0.3 USDT)
├── 100.2 USDT (买1档) ← order_book_top: 1 (价格最高，对卖方最优)
├── 100.1 USDT (买2档) ← order_book_top: 2
└── 100.0 USDT (买3档) ← order_book_top: 3 (价格最低)
买单 (Bid)  ← 有人想买的价格 ↓ 价格越低
```

**`"same"` - 使用当前价格方向**:
- **买入时**: 使用买1档价格 (100.2 USDT)
- **卖出时**: 使用卖1档价格 (100.5 USDT)
- **特点**: 可能需要等待成交，但价格更优
- **适用**: 不急于成交，希望获得更好价格

**`"other"` - 使用对手价格**:
- **买入时**: 使用卖1档价格 (100.5 USDT) - 立即买到
- **卖出时**: 使用买1档价格 (100.2 USDT) - 立即卖掉
- **特点**: 立即成交，但价格稍差
- **适用**: 急于成交，不在乎价格差异

#### `use_order_book` - 是否使用订单簿

**`true` - 使用订单簿价格**:
```python
# 策略说: "现在买入BTC"
# 配置查询订单簿: 当前买1档是100.2 USDT
# 下单: 以100.2 USDT买入
```

**`false` - 使用ticker价格**:
```python
# 策略说: "现在买入BTC" 
# 配置使用ticker: 当前价格是100.35 USDT
# 下单: 以100.35 USDT买入
```

#### `order_book_top` - 使用第几档价格

**示例订单簿**:
```
卖3档: 100.7 USDT  ← order_book_top: 3 (价格最高)
卖2档: 100.6 USDT  ← order_book_top: 2
卖1档: 100.5 USDT  ← order_book_top: 1 (默认，价格最低，对买方最优)
─────────────────── 价差 (Spread = 0.3 USDT)
买1档: 100.2 USDT  ← order_book_top: 1 (默认，价格最高，对卖方最优)
买2档: 100.1 USDT  ← order_book_top: 2
买3档: 100.0 USDT  ← order_book_top: 3 (价格最低)
```

- **`1`**: 使用最优价格 (推荐)
- **`2`**: 使用次优价格 (更容易成交)
- **`3`**: 使用第三档价格 (成交概率更高)

#### 实际应用场景

**场景1: 追求最优价格**
```json
"entry_pricing": {
  "price_side": "same",      // 买入用买1档
  "use_order_book": true,    // 使用订单簿
  "order_book_top": 1        // 用最优价格
}
```
**结果**: 价格最优，但可能等待成交

**场景2: 追求快速成交**
```json
"entry_pricing": {
  "price_side": "other",     // 买入用卖1档
  "use_order_book": true,    // 使用订单簿  
  "order_book_top": 1        // 用最优价格
}
```
**结果**: 立即成交，但价格稍差

**场景3: 平衡价格和速度**
```json
"entry_pricing": {
  "price_side": "same",      // 买入用买1档
  "use_order_book": true,    // 使用订单簿
  "order_book_top": 2        // 用次优价格
}
```
**结果**: 价格还行，成交概率高

#### 💡 **配置如何影响策略表现**

**同一个策略，不同配置，结果大不同！**

**激进配置** (追求快速成交):
```json
{
  "max_open_trades": 10,           // 多开仓位
  "stake_amount": "10%",           // 每次投10%资金
  "entry_pricing": {
    "price_side": "other",         // 立即成交
    "order_book_top": 1
  },
  "unfilledtimeout": {
    "entry": 2                     // 2分钟超时
  }
}
```
**结果**: 成交快，但成本高，风险大

**保守配置** (追求最优价格):
```json
{
  "max_open_trades": 3,            // 少开仓位
  "stake_amount": 100,             // 固定金额
  "entry_pricing": {
    "price_side": "same",          // 等待最优价格
    "order_book_top": 1
  },
  "unfilledtimeout": {
    "entry": 30                    // 30分钟超时
  }
}
```
**结果**: 价格优，但可能错过机会

## 📱 通知配置

### Telegram通知
```json
"telegram": {
  "enabled": true,
  "token": "你的BOT_TOKEN",
  "chat_id": "你的CHAT_ID"
}
```

#### 如何设置Telegram通知？
1. **创建Bot**: 
   - 找 @BotFather
   - 发送 `/newbot`
   - 获得token

2. **获取chat_id**:
   - 给你的bot发消息
   - 访问: `https://api.telegram.org/bot你的TOKEN/getUpdates`
   - 找到chat_id

## 🌐 API服务器设置

```json
"api_server": {
  "enabled": true,
  "listen_ip_address": "0.0.0.0",
  "listen_port": 8080,
  "username": "freqtrader",
  "password": "123456"
}
```
- **作用**: 提供Web界面查看交易状态
- **访问**: http://localhost:8080
- **安全**: 修改默认用户名密码！

## 📊 实战示例

### 新手推荐配置
```json
{
  "max_open_trades": 3,
  "stake_currency": "USDT",
  "stake_amount": 50,
  "dry_run": true,
  "dry_run_wallet": 1000,
  "trading_mode": "spot",
  "exchange": {
    "name": "binance",
    "pair_whitelist": ["BTC/USDT", "ETH/USDT"]
  },
  "pairlists": [{"method": "StaticPairList"}],
  "telegram": {"enabled": false}
}
```

### 进阶用户配置
```json
{
  "max_open_trades": 10,
  "stake_currency": "USDT", 
  "stake_amount": "5%",
  "dry_run": false,
  "trading_mode": "futures",
  "margin_mode": "isolated",
  "exchange": {
    "name": "binance",
    "pair_whitelist": []
  },
  "pairlists": [
    {
      "method": "VolumePairList",
      "number_assets": 30
    }
  ],
  "telegram": {"enabled": true}
}
```

## ⚠️ 常见错误和解决方案

### 1. API权限错误
```
Error: {"code":-2015,"msg":"Invalid API-key, IP, or permissions"}
```
**解决**: 检查API密钥权限，确保开启了"现货交易"或"合约交易"权限

### 2. 资金不足
```
Error: Insufficient balance
```
**解决**: 
- 检查账户余额
- 降低 `stake_amount`
- 调整 `max_open_trades`

### 3. 交易对不存在
```
Error: Pair BTC/USD not available
```
**解决**: 检查交易对格式，合约通常是 `BTC/USDT:USDT`

## 🎯 配置文件检查清单

在启动交易前，请确认：

- [ ] API密钥正确且有足够权限
- [ ] 资金设置合理 (stake_amount × max_open_trades ≤ 总资金)
- [ ] 交易对格式正确
- [ ] 风险控制参数设置合理
- [ ] 先用 `dry_run: true` 测试
- [ ] 通知设置正常工作

## 💡 小贴士

1. **从小金额开始**: 即使是实盘，也先用小金额测试
2. **定期备份配置**: 好的配置要保存备份
3. **监控日志**: 经常查看日志文件发现问题
4. **逐步调整**: 不要一次性改太多参数
5. **安全第一**: API密钥、密码等敏感信息要保护好

---

**记住**: 配置文件是你的交易规则，每个参数都会影响交易结果。理解每个参数的含义，根据自己的风险承受能力谨慎设置！
