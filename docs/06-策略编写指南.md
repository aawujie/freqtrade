# Freqtradeç­–ç•¥ç¼–å†™å®Œå…¨æŒ‡å—

## ğŸ“‹ ç›®å½•

- ç­–ç•¥å‚æ•°è¯†åˆ«æœºåˆ¶
- ç­–ç•¥çš„å¿…è¦å‚æ•° vs è‡ªå®šä¹‰å‚æ•°
- åŸºäºæ¨¡æ¿ç¼–å†™è‡ªå·±çš„ç­–ç•¥
- ç¼–å†™å¯¹åº”çš„Hyperopt Losså‡½æ•°
- å®æˆ˜æ¡ˆä¾‹ï¼šä»é›¶å¼€å§‹åˆ›å»ºç­–ç•¥

## ğŸ” ç­–ç•¥å‚æ•°è¯†åˆ«æœºåˆ¶

### 1. å‚æ•°æ˜¯å¦‚ä½•è¢«è¯†åˆ«çš„ï¼Ÿ

å½“ä½ è¿è¡Œ `freqtrade hyperopt-show` æˆ–ä½¿ç”¨ `freqtrade hyperopt` æ—¶ï¼ŒFreqtradeé€šè¿‡ä»¥ä¸‹æœºåˆ¶è¯†åˆ«ç­–ç•¥ä¸­çš„å‚æ•°ï¼š

```python
# åœ¨ç­–ç•¥ç±»ä¸­å®šä¹‰çš„å‚æ•°
class MyStrategy(IStrategy):
    # åŸºç¡€å‚æ•°ï¼ˆå¿…è¦å‚æ•°ï¼‰
    INTERFACE_VERSION = 3
    timeframe = "5m"
    minimal_roi = {"0": 0.05}
    stoploss = -0.05

    # å¯ä¼˜åŒ–å‚æ•°ï¼ˆä½¿ç”¨Parameterç±»ï¼‰
    buy_rsi = IntParameter(low=20, high=40, default=30, space="buy", optimize=True, load=True)
    sell_rsi = IntParameter(low=60, high=80, default=70, space="sell", optimize=True, load=True)

    # å›ºå®šå‚æ•°ï¼ˆä¸ä¼šè¢«ä¼˜åŒ–ï¼‰
    can_short = False
    process_only_new_candles = True
```

### 2. ä¸åŒå‚æ•°ç±»å‹çš„è¯†åˆ«

#### IntParameterï¼ˆæ•´æ•°å‚æ•°ï¼‰
```python
buy_rsi = IntParameter(
    low=20,          # æœ€å°å€¼
    high=40,         # æœ€å¤§å€¼
    default=30,      # é»˜è®¤å€¼
    space="buy",     # å‚æ•°ç©ºé—´ï¼ˆbuy/sell/stopï¼‰
    optimize=True,   # æ˜¯å¦å‚ä¸ä¼˜åŒ–
    load=True        # æ˜¯å¦ä»JSONåŠ è½½
)
```

#### DecimalParameterï¼ˆå°æ•°å‚æ•°ï¼‰
```python
stoploss = DecimalParameter(
    low=-0.3,
    high=-0.05,
    default=-0.1,
    space="stop",
    optimize=True,
    load=True
)
```

#### CategoricalParameterï¼ˆåˆ†ç±»å‚æ•°ï¼‰
```python
timeframe = CategoricalParameter(
    ["5m", "15m", "1h"],  # å€™é€‰å€¼åˆ—è¡¨
    default="5m",
    space="buy",
    optimize=True,
    load=True
)
```

### 3. å‚æ•°ç©ºé—´ (space) çš„ä½œç”¨

```python
# buyç©ºé—´ï¼šç”¨äºä¹°å…¥ä¿¡å·çš„å‚æ•°
buy_rsi = IntParameter(..., space="buy")

# sellç©ºé—´ï¼šç”¨äºå–å‡ºä¿¡å·çš„å‚æ•°
sell_rsi = IntParameter(..., space="sell")

# stopç©ºé—´ï¼šç”¨äºæ­¢æŸçš„å‚æ•°
stoploss = DecimalParameter(..., space="stop")
```

**è¯†åˆ«æœºåˆ¶**ï¼šFreqtradeé€šè¿‡åå°„æœºåˆ¶æ‰«æç­–ç•¥ç±»ä¸­æ‰€æœ‰ä»¥ `Parameter` ç»“å°¾çš„å±æ€§ã€‚

## ğŸ“Š ç­–ç•¥çš„å¿…è¦å‚æ•° vs è‡ªå®šä¹‰å‚æ•°

### 1. å¿…è¦å‚æ•°ï¼ˆå¿…é¡»å®šä¹‰ï¼‰

#### åŸºç¡€é…ç½®å‚æ•°
```python
class MyStrategy(IStrategy):
    # å¿…é¡»ï¼šæ¥å£ç‰ˆæœ¬
    INTERFACE_VERSION = 3

    # å¿…é¡»ï¼šæ—¶é—´å‘¨æœŸ
    timeframe = "5m"

    # å¿…é¡»ï¼šæœ€å°æ”¶ç›Šç›®æ ‡
    minimal_roi = {
        "60": 0.02,   # 60åˆ†é’Ÿå†…è·åˆ©2%
        "30": 0.03,   # 30åˆ†é’Ÿå†…è·åˆ©3%
        "0": 0.05     # ç«‹å³è·åˆ©5%
    }

    # å¿…é¡»ï¼šæ­¢æŸè®¾ç½®
    stoploss = -0.05  # 5%æ­¢æŸ

    # å¯é€‰ï¼šæ˜¯å¦å…è®¸åšç©º
    can_short = False
```

#### æ ¸å¿ƒæ–¹æ³•ï¼ˆå¿…é¡»å®ç°ï¼‰
```python
def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
    """è®¡ç®—æŠ€æœ¯æŒ‡æ ‡"""
    return dataframe

def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
    """ç”Ÿæˆä¹°å…¥ä¿¡å·"""
    return dataframe

def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
    """ç”Ÿæˆå–å‡ºä¿¡å·"""
    return dataframe
```

### 2. å¯é€‰å‚æ•°ï¼ˆå¯ä»¥è‡ªå®šä¹‰ï¼‰

#### äº¤æ˜“æ§åˆ¶å‚æ•°
```python
# æœ€å¤§åŒæ—¶æŒä»“æ•°é‡
max_open_trades = 3

# æ˜¯å¦åªåœ¨æ–°çš„Kçº¿äº§ç”Ÿä¿¡å·
process_only_new_candles = True

# é€€å‡ºä¿¡å·è®¾ç½®
use_exit_signal = True
exit_profit_only = False
ignore_roi_if_entry_signal = False
```

#### è®¢å•ç±»å‹è®¾ç½®
```python
order_types = {
    "entry": "limit",        # å…¥åœºè®¢å•ç±»å‹
    "exit": "limit",         # å‡ºåœºè®¢å•ç±»å‹
    "stoploss": "market",    # æ­¢æŸè®¢å•ç±»å‹
    "stoploss_on_exchange": False  # æ˜¯å¦åœ¨äº¤æ˜“æ‰€è®¾ç½®æ­¢æŸ
}

order_time_in_force = {
    "entry": "GTC",  # Good Till Cancel
    "exit": "GTC"
}
```

#### è¿½è¸ªæ­¢æŸå‚æ•°
```python
# å¯ç”¨è¿½è¸ªæ­¢æŸ
trailing_stop = False
trailing_only_offset_is_reached = False
trailing_stop_positive = 0.01
trailing_stop_positive_offset = 0.0
```

### 3. å¯ä¼˜åŒ–å‚æ•°ï¼ˆè‡ªå®šä¹‰å‚æ•°ï¼‰

è¿™äº›å‚æ•°ä½¿ç”¨ `Parameter` ç±»å®šä¹‰ï¼Œå¯ä»¥é€šè¿‡ Hyperopt è‡ªåŠ¨ä¼˜åŒ–ï¼š

#### Parameterå‚æ•°è¯¦è§£

```python
# å®Œæ•´å‚æ•°å®šä¹‰æ ¼å¼
parameter_name = ParameterType(
    low=æœ€å°å€¼,           # å‚æ•°çš„æœ€å°å€¼
    high=æœ€å¤§å€¼,          # å‚æ•°çš„æœ€å¤§å€¼
    default=é»˜è®¤å€¼,       # æ²¡æœ‰ä¼˜åŒ–æ—¶çš„é»˜è®¤å€¼
    space="å‚æ•°ç©ºé—´",     # buy/sell/stop
    optimize=True,        # âš ï¸ å…³é”®å‚æ•°ï¼šæ˜¯å¦å‚ä¸Hyperoptä¼˜åŒ–
    load=True             # æ˜¯å¦ä»JSONæ–‡ä»¶åŠ è½½ä¼˜åŒ–ç»“æœ
)
```

#### optimizeå‚æ•°çš„å«ä¹‰ â­

**`optimize=True`** æ˜¯è®©å‚æ•°èƒ½å¤Ÿè¢« Hyperopt è‡ªåŠ¨ä¼˜åŒ–çš„å…³é”®å¼€å…³ï¼š

```python
# âœ… å¯è¢«ä¼˜åŒ–çš„å‚æ•°
buy_rsi = IntParameter(20, 40, 30, space="buy", optimize=True, load=True)
# åœ¨Hyperoptè¿è¡Œæ—¶ï¼Œè¿™ä¸ªå‚æ•°çš„å€¼ä¼šåœ¨20-40ä¹‹é—´è‡ªåŠ¨æœç´¢æœ€ä¼˜å€¼

# âŒ ä¸ä¼šè¢«ä¼˜åŒ–çš„å‚æ•°
buy_rsi = IntParameter(20, 40, 30, space="buy", optimize=False, load=True)
# è¿™ä¸ªå‚æ•°å§‹ç»ˆä½¿ç”¨é»˜è®¤å€¼30ï¼ŒHyperoptä¸ä¼šæ”¹å˜å®ƒ
```

#### ä¸åŒä¼˜åŒ–çŠ¶æ€çš„å¯¹æ¯”

| å‚æ•°çŠ¶æ€ | optimize | load | Hyperoptè¡Œä¸º | å®é™…æ•ˆæœ |
|---------|----------|------|-------------|----------|
| **å¯ä¼˜åŒ–** | `True` | `True` | è‡ªåŠ¨æœç´¢æœ€ä¼˜å€¼ | å€¼åœ¨low-highåŒºé—´å˜åŒ– |
| **å›ºå®šå‚æ•°** | `False` | `True` | ä½¿ç”¨é»˜è®¤å€¼ | å€¼å§‹ç»ˆä¸ºdefault |
| **è°ƒè¯•å‚æ•°** | `True` | `False` | ä¼˜åŒ–ä½†ä¸ä¿å­˜ | åªåœ¨å½“å‰è¿è¡Œæœ‰æ•ˆ |

#### å®é™…ä½¿ç”¨ç¤ºä¾‹

```python
# RSIç›¸å…³å‚æ•°
buy_rsi = IntParameter(20, 40, 30, space="buy", optimize=True, load=True)
sell_rsi = IntParameter(60, 80, 70, space="sell", optimize=True, load=True)

# ç§»åŠ¨å¹³å‡çº¿å‚æ•°
ema_short = IntParameter(5, 20, 10, space="buy", optimize=True, load=True)
ema_long = IntParameter(20, 50, 30, space="buy", optimize=True, load=True)

# å¸ƒæ—å¸¦å‚æ•°
bb_window = IntParameter(15, 25, 20, space="buy", optimize=True, load=True)
bb_std = DecimalParameter(1.8, 2.5, 2.0, space="buy", optimize=True, load=True)

# å›ºå®šå‚æ•°ï¼ˆä¸æƒ³ä¼˜åŒ–çš„ï¼‰
rsi_period = 14  # å›ºå®šRSIå‘¨æœŸï¼Œä¸å‚ä¸ä¼˜åŒ–
```

#### ä¼˜åŒ–ç­–ç•¥å»ºè®®

1. **æ ¸å¿ƒå‚æ•°**ï¼šè®¾ç½® `optimize=True`ï¼Œè®©Hyperopté‡ç‚¹ä¼˜åŒ–
2. **ç»éªŒå‚æ•°**ï¼šå¦‚æœä½ æœ‰ä¸°å¯Œçš„ç»éªŒï¼Œå¯ä»¥è®¾ç½® `optimize=False` ä½¿ç”¨å›ºå®šå€¼
3. **æµ‹è¯•å‚æ•°**ï¼šæ–°æ·»åŠ çš„å‚æ•°å…ˆè®¾ `optimize=True` æµ‹è¯•æ•ˆæœ
4. **ç»„åˆä¼˜åŒ–**ï¼šä¸è¦è®©æ‰€æœ‰å‚æ•°éƒ½å¯ä¼˜åŒ–ï¼Œé€‚å½“å›ºå®šä¸€äº›å‚æ•°å‡å°‘æœç´¢ç©ºé—´

```python
# æ¨èçš„ä¼˜åŒ–ç­–ç•¥
class MyStrategy(IStrategy):
    # æ ¸å¿ƒäº¤æ˜“å‚æ•° - é‡ç‚¹ä¼˜åŒ–
    buy_rsi = IntParameter(25, 35, 30, space="buy", optimize=True, load=True)
    sell_rsi = IntParameter(65, 75, 70, space="sell", optimize=True, load=True)

    # æŠ€æœ¯æŒ‡æ ‡å‚æ•° - é€‚åº¦ä¼˜åŒ–
    ema_short = IntParameter(8, 15, 12, space="buy", optimize=True, load=True)
    ema_long = IntParameter(25, 35, 30, space="buy", optimize=True, load=True)

    # å›ºå®šå‚æ•° - åŸºäºç»éªŒç¡®å®š
    rsi_period = 14  # RSIå‘¨æœŸå›ºå®šä¸º14
    volume_multiplier = 1.5  # æˆäº¤é‡å€æ•°å›ºå®š
```

## ğŸ› ï¸ åŸºäºæ¨¡æ¿ç¼–å†™è‡ªå·±çš„ç­–ç•¥

### æ­¥éª¤1ï¼šå¤åˆ¶æ¨¡æ¿æ–‡ä»¶

```bash
cp user_data/strategies/sample_strategy.py user_data/strategies/my_strategy.py
```

### æ­¥éª¤2ï¼šä¿®æ”¹ç­–ç•¥åç§°å’ŒåŸºæœ¬ä¿¡æ¯

```python
# ä¿®æ”¹ç±»å
class MyRSIStrategy(IStrategy):  # ä» SampleStrategy æ”¹ä¸º MyRSIStrategy
    """
    åŸºäºRSIçš„äº¤æ˜“ç­–ç•¥
    ä¹°å…¥ï¼šRSI < 30
    å–å‡ºï¼šRSI > 70
    """

    # ä¿®æ”¹ç­–ç•¥å…ƒæ•°æ®
    INTERFACE_VERSION = 3
    timeframe = "15m"  # ä»5åˆ†é’Ÿæ”¹ä¸º15åˆ†é’Ÿ
    can_short = False  # ä¸å…è®¸åšç©º

    # ä¿®æ”¹æ”¶ç›Šç›®æ ‡
    minimal_roi = {
        "120": 0.01,   # 2å°æ—¶å†…è·åˆ©1%
        "60": 0.02,    # 1å°æ—¶å†…è·åˆ©2%
        "30": 0.03,    # 30åˆ†é’Ÿå†…è·åˆ©3%
        "0": 0.05      # ç«‹å³è·åˆ©5%
    }

    # ä¿®æ”¹æ­¢æŸ
    stoploss = -0.08  # 8%æ­¢æŸ
```

### æ­¥éª¤3ï¼šå®šä¹‰å¯ä¼˜åŒ–å‚æ•°

```python
# RSIå‚æ•°
buy_rsi_threshold = IntParameter(
    low=25, high=35, default=30,
    space="buy", optimize=True, load=True
)

sell_rsi_threshold = IntParameter(
    low=65, high=75, default=70,
    space="sell", optimize=True, load=True
)

# ç¡®è®¤æŒ‡æ ‡å‚æ•°
ema_period = IntParameter(
    low=10, high=30, default=20,
    space="buy", optimize=True, load=True
)

# æˆäº¤é‡è¿‡æ»¤
min_volume_multiplier = DecimalParameter(
    low=1.0, high=3.0, default=1.5,
    space="buy", optimize=True, load=True
)
```

### æ­¥éª¤4ï¼šå®ç°æŠ€æœ¯æŒ‡æ ‡è®¡ç®—

```python
def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
    """è®¡ç®—æŠ€æœ¯æŒ‡æ ‡"""

    # RSIæŒ‡æ ‡
    dataframe['rsi'] = ta.RSI(dataframe, timeperiod=14)

    # EMAæŒ‡æ ‡ï¼ˆç”¨äºè¶‹åŠ¿ç¡®è®¤ï¼‰
    dataframe['ema'] = ta.EMA(dataframe, timeperiod=self.ema_period.value)

    # å¸ƒæ—å¸¦ï¼ˆç”¨äºæ³¢åŠ¨ç‡åˆ¤æ–­ï¼‰
    bollinger = qtpylib.bollinger_bands(
        qtpylib.typical_price(dataframe),
        window=20, stds=2
    )
    dataframe['bb_upper'] = bollinger['upper']
    dataframe['bb_lower'] = bollinger['lower']
    dataframe['bb_middle'] = bollinger['mid']

    # å¹³å‡æˆäº¤é‡
    dataframe['volume_mean'] = dataframe['volume'].rolling(window=20).mean()

    return dataframe
```

### æ­¥éª¤5ï¼šå®ç°ä¹°å…¥é€»è¾‘

```python
def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
    """ç”Ÿæˆä¹°å…¥ä¿¡å·"""

    dataframe.loc[
        (
            # ä¸»è¦ä¿¡å·ï¼šRSIè¶…å–
            (dataframe['rsi'] < self.buy_rsi_threshold.value)

            # è¶‹åŠ¿ç¡®è®¤ï¼šä»·æ ¼åœ¨EMAä¸Šæ–¹ï¼ˆä¸Šæ¶¨è¶‹åŠ¿ï¼‰
            & (dataframe['close'] > dataframe['ema'])

            # æ³¢åŠ¨ç‡ç¡®è®¤ï¼šä»·æ ¼æ¥è¿‘ä¸‹è½¨ï¼ˆæœ‰åå¼¹ç©ºé—´ï¼‰
            & (dataframe['close'] < dataframe['bb_middle'])

            # æˆäº¤é‡ç¡®è®¤ï¼šæˆäº¤é‡æ”¾å¤§
            & (dataframe['volume'] > dataframe['volume_mean'] * self.min_volume_multiplier.value)

            # ç¡®ä¿æˆäº¤é‡ä¸ä¸º0
            & (dataframe['volume'] > 0)
        ),
        'enter_long'
    ] = 1

    return dataframe
```

### æ­¥éª¤6ï¼šå®ç°å–å‡ºé€»è¾‘

```python
def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
    """ç”Ÿæˆå–å‡ºä¿¡å·"""

    dataframe.loc[
        (
            # ä¸»è¦ä¿¡å·ï¼šRSIè¶…ä¹°
            (dataframe['rsi'] > self.sell_rsi_threshold.value)

            # æˆ–è€…ä»·æ ¼è§¦åŠä¸Šè½¨ï¼ˆè·åˆ©äº†ç»“ï¼‰
            | (dataframe['close'] > dataframe['bb_upper'])
        ),
        'exit_long'
    ] = 1

    return dataframe
```

### æ­¥éª¤7ï¼šæ·»åŠ è¾…åŠ©æ–¹æ³•ï¼ˆå¯é€‰ï¼‰

```python
def informative_pairs(self):
    """å®šä¹‰é¢å¤–çš„å‚è€ƒæ•°æ®"""
    return [
        ("BTC/USDT", "1h"),  # æ¯”ç‰¹å¸1å°æ—¶æ•°æ®ä½œä¸ºå‚è€ƒ
        ("ETH/USDT", "1h"),  # ä»¥å¤ªåŠ1å°æ—¶æ•°æ®ä½œä¸ºå‚è€ƒ
    ]

def leverage(self, pair: str, current_time: datetime, current_rate: float,
             proposed_leverage: float, max_leverage: float, entry_tag: Optional[str],
             side: str, **kwargs) -> float:
    """è‡ªå®šä¹‰æ æ†è®¾ç½®"""
    return 1.0  # ä½¿ç”¨1å€æ æ†ï¼ˆç°è´§äº¤æ˜“ï¼‰
```

## ğŸ¯ ç¼–å†™å¯¹åº”çš„Hyperopt Losså‡½æ•°

### 1. ç†è§£Losså‡½æ•°çš„ä½œç”¨

Losså‡½æ•°ç”¨äºé‡åŒ–ç­–ç•¥çš„"å¥½å"ç¨‹åº¦ï¼š

```python
# Freqtradeé»˜è®¤çš„Losså‡½æ•°é€»è¾‘ï¼š
# 1. è®¡ç®—æ€»åˆ©æ¶¦
# 2. è®¡ç®—äº¤æ˜“æ¬¡æ•°
# 3. è®¡ç®—å¹³å‡æŒä»“æ—¶é—´
# 4. ç»¼åˆè¯„åˆ†ï¼ˆè¶Šå°è¶Šå¥½ï¼‰
```

### 2. è‡ªå®šä¹‰Losså‡½æ•°æ¨¡æ¿

```python
from datetime import datetime
from math import exp
from pandas import DataFrame
from freqtrade.constants import Config
from freqtrade.optimize.hyperopt import IHyperOptLoss

class MyCustomHyperOptLoss(IHyperOptLoss):
    """
    è‡ªå®šä¹‰çš„Hyperopt Losså‡½æ•°
    ç›®æ ‡ï¼šå¹³è¡¡åˆ©æ¶¦ã€é£é™©å’Œäº¤æ˜“é¢‘ç‡
    """

    @staticmethod
    def hyperopt_loss_function(
        results: DataFrame,
        trade_count: int,
        min_date: datetime,
        max_date: datetime,
        config: Config,
        processed: dict[str, DataFrame],
        *args,
        **kwargs,
    ) -> float:
        """
        è‡ªå®šä¹‰ç›®æ ‡å‡½æ•°
        è¿”å›å€¼è¶Šå°ï¼Œç­–ç•¥è¡¨ç°è¶Šå¥½
        """

        # 1. åŸºç¡€æŒ‡æ ‡è®¡ç®—
        total_profit = results['profit_ratio'].sum()  # æ€»åˆ©æ¶¦
        win_rate = (results['profit_ratio'] > 0).sum() / len(results)  # èƒœç‡
        avg_profit = results['profit_ratio'].mean()  # å¹³å‡åˆ©æ¶¦
        max_drawdown = results['max_drawdown'].max()  # æœ€å¤§å›æ’¤

        # 2. äº¤æ˜“é¢‘ç‡è¯„ä¼°
        days = (max_date - min_date).days
        trades_per_day = trade_count / days if days > 0 else 0

        # 3. è®¡ç®—å„é¡¹æŸå¤±
        # åˆ©æ¶¦æŸå¤±ï¼šæœŸæœ›åˆ©æ¶¦ä¸ºæ­£æ•°
        profit_loss = max(0, 1 - total_profit / 2.0)  # æœŸæœ›æ€»åˆ©æ¶¦è‡³å°‘2.0

        # èƒœç‡æŸå¤±ï¼šæœŸæœ›èƒœç‡è‡³å°‘40%
        win_rate_loss = max(0, 1 - win_rate / 0.4)

        # å›æ’¤æŸå¤±ï¼šæœŸæœ›æœ€å¤§å›æ’¤ä¸è¶…è¿‡15%
        drawdown_loss = max(0, max_drawdown - 0.15) * 2

        # äº¤æ˜“é¢‘ç‡æŸå¤±ï¼šæœŸæœ›æ¯å¤©1-5ç¬”äº¤æ˜“
        if trades_per_day < 1:
            freq_loss = 1 - trades_per_day  # äº¤æ˜“è¿‡å°‘
        elif trades_per_day > 5:
            freq_loss = (trades_per_day - 5) * 0.1  # äº¤æ˜“è¿‡å¤š
        else:
            freq_loss = 0

        # 4. ç»¼åˆè¯„åˆ†
        total_loss = (
            profit_loss * 0.4 +      # åˆ©æ¶¦æƒé‡40%
            win_rate_loss * 0.3 +    # èƒœç‡æƒé‡30%
            drawdown_loss * 0.2 +    # å›æ’¤æƒé‡20%
            freq_loss * 0.1          # é¢‘ç‡æƒé‡10%
        )

        return total_loss
```

### 3. ä¸åŒç­–ç•¥ç±»å‹çš„Losså‡½æ•°ç¤ºä¾‹

#### 3.1 ä¿å®ˆå‹ç­–ç•¥çš„Losså‡½æ•°

```python
class ConservativeHyperOptLoss(IHyperOptLoss):
    """
    ä¿å®ˆå‹ç­–ç•¥ï¼šé‡ç‚¹å…³æ³¨å›æ’¤æ§åˆ¶
    """

    @staticmethod
    def hyperopt_loss_function(results: DataFrame, trade_count: int, *args, **kwargs) -> float:
        total_profit = results['profit_ratio'].sum()
        max_drawdown = results['max_drawdown'].max()
        avg_trade_duration = results['trade_duration'].mean()

        # é‡ç‚¹æƒ©ç½šé«˜å›æ’¤
        drawdown_penalty = max_drawdown * 3  # å›æ’¤æƒé‡æ›´é«˜

        # åˆ©æ¶¦è¦æ±‚ä¸é«˜ï¼Œä½†ä¸èƒ½äºæŸ
        profit_penalty = max(0, -total_profit) * 2

        # åå¥½è¾ƒé•¿æŒä»“æ—¶é—´ï¼ˆé™ä½äº¤æ˜“é¢‘ç‡ï¼‰
        duration_bonus = max(0, avg_trade_duration - 60) * 0.01  # è¶…è¿‡1å°æ—¶æœ‰å¥–åŠ±

        return drawdown_penalty + profit_penalty - duration_bonus
```

#### 3.2 é«˜é¢‘äº¤æ˜“ç­–ç•¥çš„Losså‡½æ•°

```python
class HighFrequencyHyperOptLoss(IHyperOptLoss):
    """
    é«˜é¢‘ç­–ç•¥ï¼šé‡ç‚¹å…³æ³¨äº¤æ˜“é¢‘ç‡å’Œæ»‘ç‚¹æˆæœ¬
    """

    @staticmethod
    def hyperopt_loss_function(results: DataFrame, trade_count: int, *args, **kwargs) -> float:
        total_profit = results['profit_ratio'].sum()
        trade_count_penalty = abs(trade_count - 1000) * 0.001  # æœŸæœ›1000ç¬”äº¤æ˜“

        # è€ƒè™‘æ»‘ç‚¹æˆæœ¬ï¼ˆé«˜é¢‘äº¤æ˜“æ»‘ç‚¹å½±å“æ›´å¤§ï¼‰
        avg_profit = results['profit_ratio'].mean()
        slippage_impact = max(0, 0.001 - avg_profit) * 1000  # å•ç¬”åˆ©æ¶¦ä¸èƒ½ä½äº0.1%

        # å¿«é€Ÿè¿›å‡ºï¼ˆé™ä½æŒä»“é£é™©ï¼‰
        avg_duration = results['trade_duration'].mean()
        duration_penalty = max(0, avg_duration - 30) * 0.01  # æœŸæœ›å¹³å‡30åˆ†é’Ÿå†…å®Œæˆ

        return trade_count_penalty + slippage_impact + duration_penalty
```

#### 3.3 è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥çš„Losså‡½æ•°

```python
class TrendFollowingHyperOptLoss(IHyperOptLoss):
    """
    è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥ï¼šé‡ç‚¹å…³æ³¨å¤§è¶‹åŠ¿å’Œå¤§åˆ©æ¶¦
    """

    @staticmethod
    def hyperopt_loss_function(results: DataFrame, trade_count: int, *args, **kwargs) -> float:
        # åˆ†ç¦»å¤§åˆ©æ¶¦äº¤æ˜“å’Œå°åˆ©æ¶¦äº¤æ˜“
        large_profits = results[results['profit_ratio'] > 0.05]  # å¤§äº5%çš„åˆ©æ¶¦
        small_profits = results[(results['profit_ratio'] > 0) & (results['profit_ratio'] <= 0.05)]

        # å¥–åŠ±å¤§åˆ©æ¶¦äº¤æ˜“
        large_profit_bonus = large_profits['profit_ratio'].sum() * 2

        # è½»å¾®æƒ©ç½šå°åˆ©æ¶¦äº¤æ˜“ï¼ˆé¼“åŠ±å¤§åˆ©æ¶¦ï¼‰
        small_profit_penalty = small_profits['profit_ratio'].sum() * 0.5

        # æ€»åˆ©æ¶¦
        total_profit = results['profit_ratio'].sum()

        # äº¤æ˜“é¢‘ç‡ï¼ˆè¶‹åŠ¿ç­–ç•¥ä¸éœ€è¦å¤ªé¢‘ç¹ï¼‰
        freq_penalty = max(0, trade_count - 200) * 0.01

        return -large_profit_bonus + small_profit_penalty - total_profit + freq_penalty
```

### 4. Losså‡½æ•°è°ƒè¯•æŠ€å·§

```python
def debug_loss_function(results: DataFrame, trade_count: int, *args, **kwargs) -> float:
    """
    è°ƒè¯•ç”¨çš„Losså‡½æ•°ï¼Œä¼šæ‰“å°è¯¦ç»†ä¿¡æ¯
    """
    total_profit = results['profit_ratio'].sum()
    win_rate = (results['profit_ratio'] > 0).sum() / len(results)
    max_drawdown = results['max_drawdown'].max()

    print(f"""
    è°ƒè¯•ä¿¡æ¯:
    æ€»åˆ©æ¶¦: {total_profit:.4f}
    èƒœç‡: {win_rate:.2%}
    æœ€å¤§å›æ’¤: {max_drawdown:.2%}
    äº¤æ˜“æ¬¡æ•°: {trade_count}
    """)

    # è®¡ç®—å„é¡¹æŸå¤±
    profit_loss = max(0, 1 - total_profit / 2.0)
    win_rate_loss = max(0, 1 - win_rate / 0.4)
    drawdown_loss = max(0, max_drawdown - 0.15) * 2

    total_loss = profit_loss + win_rate_loss + drawdown_loss

    print(f"å„é¡¹æŸå¤±: åˆ©æ¶¦={profit_loss:.4f}, èƒœç‡={win_rate_loss:.4f}, å›æ’¤={drawdown_loss:.4f}")
    print(f"æ€»æŸå¤±: {total_loss:.4f}")

    return total_loss
```

## ğŸ¯ å®æˆ˜æ¡ˆä¾‹ï¼šä»é›¶å¼€å§‹åˆ›å»ºç­–ç•¥

### æ¡ˆä¾‹1ï¼šåŒå‡çº¿ç­–ç•¥

```python
class DoubleEMAStrategy(IStrategy):
    """
    åŒå‡çº¿äº¤å‰ç­–ç•¥
    å¿«çº¿ä¸Šç©¿æ…¢çº¿ï¼šä¹°å…¥
    å¿«çº¿ä¸‹ç©¿æ…¢çº¿ï¼šå–å‡º
    """

    INTERFACE_VERSION = 3
    timeframe = "1h"

    minimal_roi = {
        "1440": 0.02,  # 24å°æ—¶å†…è·åˆ©2%
        "720": 0.03,   # 12å°æ—¶å†…è·åˆ©3%
        "360": 0.04,   # 6å°æ—¶å†…è·åˆ©4%
        "0": 0.06      # ç«‹å³è·åˆ©6%
    }

    stoploss = -0.08

    # å¯ä¼˜åŒ–å‚æ•°
    fast_ema = IntParameter(5, 20, 10, space="buy", optimize=True, load=True)
    slow_ema = IntParameter(20, 50, 30, space="buy", optimize=True, load=True)

    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
        dataframe['fast_ema'] = ta.EMA(dataframe, timeperiod=self.fast_ema.value)
        dataframe['slow_ema'] = ta.EMA(dataframe, timeperiod=self.slow_ema.value)
        return dataframe

    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
        dataframe.loc[
            qtpylib.crossed_above(dataframe['fast_ema'], dataframe['slow_ema']),
            'enter_long'
        ] = 1
        return dataframe

    def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
        dataframe.loc[
            qtpylib.crossed_below(dataframe['fast_ema'], dataframe['slow_ema']),
            'exit_long'
        ] = 1
        return dataframe
```

### æ¡ˆä¾‹2ï¼šRSI+å¸ƒæ—å¸¦ç­–ç•¥

```python
class RSI_BollingerStrategy(IStrategy):
    """
    RSI + å¸ƒæ—å¸¦ç»„åˆç­–ç•¥
    åœ¨å¸ƒæ—å¸¦ä¸‹è½¨é™„è¿‘ä¸”RSIè¶…å–æ—¶ä¹°å…¥
    åœ¨å¸ƒæ—å¸¦ä¸Šè½¨é™„è¿‘ä¸”RSIè¶…ä¹°æ—¶å–å‡º
    """

    INTERFACE_VERSION = 3
    timeframe = "30m"

    minimal_roi = {
        "240": 0.015,  # 4å°æ—¶å†…è·åˆ©1.5%
        "120": 0.025,  # 2å°æ—¶å†…è·åˆ©2.5%
        "60": 0.035,   # 1å°æ—¶å†…è·åˆ©3.5%
        "0": 0.055     # ç«‹å³è·åˆ©5.5%
    }

    stoploss = -0.06

    # å¯ä¼˜åŒ–å‚æ•°
    rsi_period = IntParameter(10, 20, 14, space="buy", optimize=True, load=True)
    rsi_buy = IntParameter(20, 35, 30, space="buy", optimize=True, load=True)
    rsi_sell = IntParameter(65, 80, 70, space="sell", optimize=True, load=True)
    bb_window = IntParameter(15, 25, 20, space="buy", optimize=True, load=True)

    def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
        # RSI
        dataframe['rsi'] = ta.RSI(dataframe, timeperiod=self.rsi_period.value)

        # å¸ƒæ—å¸¦
        bollinger = qtpylib.bollinger_bands(
            qtpylib.typical_price(dataframe),
            window=self.bb_window.value,
            stds=2
        )
        dataframe['bb_upper'] = bollinger['upper']
        dataframe['bb_lower'] = bollinger['lower']
        dataframe['bb_middle'] = bollinger['mid']

        return dataframe

    def populate_entry_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
        dataframe.loc[
            (
                (dataframe['rsi'] < self.rsi_buy.value) &
                (dataframe['close'] < dataframe['bb_lower'] * 1.01) &  # æ¥è¿‘ä¸‹è½¨1%
                (dataframe['volume'] > 0)
            ),
            'enter_long'
        ] = 1
        return dataframe

    def populate_exit_trend(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
        dataframe.loc[
            (
                (dataframe['rsi'] > self.rsi_sell.value) |
                (dataframe['close'] > dataframe['bb_upper'] * 0.99)  # æ¥è¿‘ä¸Šè½¨1%
            ),
            'exit_long'
        ] = 1
        return dataframe
```

## ğŸ“‹ æ€»ç»“

### ç­–ç•¥ç¼–å†™æ ¸å¿ƒè¦ç‚¹

1. **ç»§æ‰¿åŸºç¡€**ï¼šä» `IStrategy` ç»§æ‰¿
2. **å‚æ•°å®šä¹‰**ï¼šæ˜ç¡®åŒºåˆ†å¿…è¦å‚æ•°å’Œè‡ªå®šä¹‰å‚æ•°
3. **æ–¹æ³•å®ç°**ï¼šå¿…é¡»å®ç°ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•
4. **å‚æ•°ä¼˜åŒ–**ï¼šä½¿ç”¨ `Parameter` ç±»å®šä¹‰å¯ä¼˜åŒ–å‚æ•°
5. **ä¿¡å·é€»è¾‘**ï¼šæ¸…æ™°çš„ä¹°å…¥å’Œå–å‡ºæ¡ä»¶
6. **é£é™©æ§åˆ¶**ï¼šåˆç†çš„æ­¢æŸå’Œæ”¶ç›Šç›®æ ‡

### Losså‡½æ•°è®¾è®¡åŸåˆ™

1. **ç›®æ ‡æ˜ç¡®**ï¼šæ ¹æ®ç­–ç•¥ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„ä¼˜åŒ–ç›®æ ‡
2. **æƒé‡å¹³è¡¡**ï¼šåˆç†åˆ†é…å„é¡¹æŒ‡æ ‡çš„æƒé‡
3. **é£é™©æ„è¯†**ï¼šé‡è§†å›æ’¤æ§åˆ¶
4. **å®ç”¨æ€§**ï¼šè€ƒè™‘å®é™…äº¤æ˜“æˆæœ¬å’Œé™åˆ¶
5. **å¯è°ƒè¯•**ï¼šä¾¿äºåˆ†æå’Œè°ƒæ•´

### æœ€ä½³å®è·µå»ºè®®

1. **ä»å°å¼€å§‹**ï¼šä»ç®€å•ç­–ç•¥å¼€å§‹ï¼Œé€æ­¥å¢åŠ å¤æ‚åº¦
2. **å……åˆ†å›æµ‹**ï¼šåœ¨ä¸åŒå¸‚åœºæ¡ä»¶ä¸‹æµ‹è¯•ç­–ç•¥
3. **å‚æ•°ä¼˜åŒ–**ï¼šä½¿ç”¨Hyperoptæ‰¾åˆ°æœ€ä½³å‚æ•°ç»„åˆ
4. **é£é™©æ§åˆ¶**ï¼šå§‹ç»ˆæŠŠé£é™©ç®¡ç†æ”¾åœ¨é¦–ä½
5. **æŒç»­æ”¹è¿›**ï¼šæ ¹æ®å®ç›˜è¡¨ç°è°ƒæ•´ç­–ç•¥

---

**ğŸ’¡ è®°ä½**ï¼šç­–ç•¥ç¼–å†™æ˜¯ä¸€ä¸ªè¿­ä»£è¿‡ç¨‹ã€‚ä¸è¦æœŸæœ›ç¬¬ä¸€æ¬¡å°±èƒ½å†™å‡ºå®Œç¾çš„ç­–ç•¥ï¼Œé€šè¿‡ä¸æ–­çš„æµ‹è¯•ã€ä¼˜åŒ–å’Œæ”¹è¿›ï¼Œæ‰èƒ½æ‰“é€ å‡ºçœŸæ­£é€‚åˆè‡ªå·±çš„äº¤æ˜“ç­–ç•¥ï¼
